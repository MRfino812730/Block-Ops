<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>BLOCKS OPS - Full Edition</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Courier New', monospace; }
        
        /* INTERFAZ DEL MENÚ */
        #menu-inicio {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), radial-gradient(circle, #333 0%, #000 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; color: white; text-align: center;
        }
        .title-container { border-top: 4px solid #f00; border-bottom: 4px solid #f00; padding: 20px 0; margin-bottom: 20px; width: 80%; max-width: 800px; }
        #menu-inicio h1 { font-size: 80px; margin: 0; letter-spacing: 15px; color: #fff; text-shadow: 0 0 20px #f00; font-weight: 900; }
        
        .map-selector { display: flex; gap: 20px; margin: 20px 0; }
        .map-card { border: 2px solid #444; padding: 15px; cursor: pointer; width: 160px; background: rgba(0,0,0,0.5); transition: 0.3s; }
        .map-selected { border-color: #f00; background: rgba(255,0,0,0.2); box-shadow: 0 0 15px #f00; }

        #audio-msg { color: #0f0; margin-bottom: 10px; animation: blink 1s infinite; cursor: pointer; font-weight: bold; }
        @keyframes blink { 50% { opacity: 0; } }

        #btn-jugar {
            background: #f00; border: none; color: white; padding: 15px 60px; font-size: 24px; cursor: pointer;
            font-weight: bold; clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); margin-top: 20px;
            opacity: 0.5; pointer-events: none;
        }
        .ready { opacity: 1 !important; pointer-events: all !important; }

        /* FIRMA DE AUTOR */
        #creditos { margin-top: 40px; color: #555; font-size: 14px; letter-spacing: 2px; }

        #hud { position: fixed; bottom: 85px; left: 20px; z-index: 10; display: none; }
        .stat-box { background: rgba(0, 0, 0, 0.85); color: #0f0; padding: 12px 20px; margin-top: 5px; min-width: 200px; font-size: 18px; border-left: 5px solid #f00; text-transform: uppercase; }
        #crosshair { position: fixed; top: 50%; left: 50%; width: 16px; height: 16px; border: 2px solid #0f0; border-radius: 50%; transform: translate(-50%, -50%); z-index: 10; display: none; }
    </style>
  </head>
  <body>

    <div id="menu-inicio">
        <div class="title-container"><h1>BLOCKS OPS</h1></div>
        <p id="audio-msg" onclick="desbloquearAudio()">[ 1. CLIC AQUÍ PARA CARGAR AUDIO ]</p>
        
        <div class="map-selector">
            <div id="map1" class="map-card" onclick="selectMap('almacen')">ALMACÉN</div>
            <div id="map2" class="map-card map-selected" onclick="selectMap('ciudad')">CIUDAD</div>
        </div>

        <button id="btn-jugar" onclick="iniciarJuego()">2. INICIAR MISIÓN</button>
        
        <div id="creditos">HECHO POR ANDY RR</div>
    </div>

    <div id="hud">
        <div class="stat-box">ESTADO: <span id="hp">100%</span></div>
        <div class="stat-box">BALAS: <span id="ammo">30</span></div>
        <div class="stat-box">BAJAS: <span id="score">0</span></div>
    </div>
    <div id="crosshair"></div>

    <audio id="snd-glock" src="sound_weapons_glock18_glock18-1.wav" preload="auto"></audio>
    <audio id="music-menu" src="Snapiyy audio - I am my perimeter.mp3" loop preload="auto"></audio>
    <audio id="music-game" src="Don Aitor - Invasión zombi.mp3" loop preload="auto"></audio>

    <a-scene loading-screen="enabled: false">
      <a-sky id="sky" color="#111"></a-sky>
      <a-light type="ambient" intensity="0.8"></a-light>
      <a-light type="directional" position="1 10 5" intensity="0.6"></a-light>

      <a-entity id="rig" movement-controls="controls: keyboard; speed: 0.2">
        <a-entity id="camera" camera look-controls="pointerLockEnabled: true" position="0 1.6 0">
            <a-entity id="view-model" position="0.35 -0.35 -0.5">
                <a-box position="0 0.1 0.2" width="0.1" height="0.1" depth="0.5" color="#ff0000" rotation="-10 0 0"></a-box>
                <a-box position="-0.5 0.05 0.1" width="0.1" height="0.1" depth="0.4" color="#ff0000" rotation="0 40 0"></a-box>
                <a-box id="gun-model" width="0.06" height="0.12" depth="0.8" color="#222"></a-box>
            </a-entity>
        </a-entity>
      </a-entity>
      <a-entity id="world"></a-entity>
    </a-scene>

    <script>
      let gameActive = false, score = 0, hp = 100, ammo = 30, selectedMap = 'ciudad', audioReady = false;

      function desbloquearAudio() {
          const menuMusic = document.getElementById('music-menu');
          menuMusic.play().then(() => {
              audioReady = true;
              document.getElementById('audio-msg').innerText = "SISTEMAS ONLINE";
              document.getElementById('audio-msg').style.color = "#fff";
              document.getElementById('btn-jugar').classList.add('ready');
          });
      }

      function selectMap(m) {
          selectedMap = m;
          document.getElementById('map1').classList.toggle('map-selected', m === 'almacen');
          document.getElementById('map2').classList.toggle('map-selected', m === 'ciudad');
      }

      function buildMap() {
          const w = document.getElementById('world');
          const sky = document.getElementById('sky');
          w.innerHTML = '';
          if(selectedMap === 'ciudad') {
              sky.setAttribute('color', '#87CEEB');
              w.innerHTML += '<a-plane rotation="-90 0 0" width="200" height="200" color="#333"></a-plane>';
          } else {
              sky.setAttribute('color', '#111');
              w.innerHTML += '<a-plane rotation="-90 0 0" width="100" height="100" color="#1a1a1a"></a-plane>';
          }
      }

      function iniciarJuego() {
          if(!audioReady) return;
          gameActive = true;
          document.getElementById('menu-inicio').style.display = 'none';
          document.getElementById('hud').style.display = 'block';
          document.getElementById('crosshair').style.display = 'block';
          document.getElementById('music-menu').pause();
          document.getElementById('music-game').play();
          buildMap();
          spawnZombies();
          document.body.requestPointerLock();
      }

      window.addEventListener('mousedown', () => {
          if(!gameActive || ammo <= 0) return;
          const s = document.getElementById('snd-glock');
          s.currentTime = 0;
          s.play();
          ammo--;
          document.getElementById('ammo').innerText = ammo;
          const vm = document.getElementById('view-model');
          vm.setAttribute('position', '0.35 -0.35 -0.45');
          setTimeout(() => vm.setAttribute('position', '0.35 -0.35 -0.5'), 60);
      });

      let t = 0;
      setInterval(() => {
          if(!gameActive) return;
          t += 0.15;
          document.getElementById('camera').object3D.position.y = 1.6 + Math.sin(t) * 0.02;
      }, 50);

      function spawnZombies() {
          if(!gameActive) return;
          let z = document.createElement('a-box');
          z.setAttribute('color', '#2a3b2a');
          z.setAttribute('position', `${(Math.random()-0.5)*40} 0.9 ${(Math.random()-0.5)*40}`);
          document.getElementById('world').appendChild(z);
          setTimeout(spawnZombies, 3000);
      }
    </script>
  </body>
</html>